{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function OrderManagement(){const[orders,setOrders]=useState([]);const[errorMessage,setErrorMessage]=useState('');const navigate=useNavigate();useEffect(()=>{const userEmail=localStorage.getItem('userEmail');// Validate if the user email belongs to an admin\nif(userEmail){validateAdmin(userEmail);}else{alert('Please log in first');navigate('/login-admin');}},[navigate]);// Validate if the email exists in the admins table\nconst validateAdmin=async email=>{try{const response=await fetch('http://localhost:3000/validate-admin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});const data=await response.json();// If the email is not valid, redirect to login\nif(!data.valid){alert('You are not authorized to access this page. Please log in as an admin.');navigate('/login');}else{// Fetch orders only if the admin validation is successful\nfetchOrders();}}catch(error){console.error('Validation error:',error);alert('An error occurred during validation. Please log in again.');navigate('/login');}};// Fetch all orders from the backend\nconst fetchOrders=async()=>{try{const response=await fetch('http://localhost:3000/orders');if(response.ok){const data=await response.json();setOrders(data);}else{setErrorMessage('Failed to fetch orders');}}catch(error){setErrorMessage('Error fetching orders');}};// Update order status to \"Picked Up\"\nconst updateOrderStatus=async orderId=>{try{const response=await fetch(`http://localhost:3000/orders/${orderId}/pickup`,{method:'PUT',headers:{'Content-Type':'application/json'}});if(response.ok){setOrders(orders.map(order=>order.id===orderId?{...order,status:'Picked Up'}:order));}else{setErrorMessage('Failed to update order status');}}catch(error){setErrorMessage('Error updating order status');}};// Delete an order\nconst deleteOrder=async orderId=>{try{const response=await fetch(`http://localhost:3000/orders/${orderId}`,{method:'DELETE'});if(response.ok){setOrders(orders.filter(order=>order.id!==orderId));}else{setErrorMessage('Failed to delete order');}}catch(error){setErrorMessage('Error deleting order');}};// Navigate to reassignOrders page\nconst handleReassignOrder=()=>{navigate('/reassignOrders');};return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-center my-4\",children:\"Order Management\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-warning mb-3\",onClick:handleReassignOrder,children:\"Reassign Order\"}),errorMessage&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:errorMessage}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Pickup Location\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Drop-Off Location\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Package Details\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Delivery Time\"}),/*#__PURE__*/_jsx(\"th\",{children:\"User ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:orders.map(order=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:order.id}),/*#__PURE__*/_jsx(\"td\",{children:order.pickup_location}),/*#__PURE__*/_jsx(\"td\",{children:order.drop_off_location}),/*#__PURE__*/_jsx(\"td\",{children:order.package_details}),/*#__PURE__*/_jsx(\"td\",{children:order.delivery_time}),/*#__PURE__*/_jsx(\"td\",{children:order.user_id}),/*#__PURE__*/_jsx(\"td\",{children:order.status||'Pending'}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary btn-sm mx-1\",onClick:()=>updateOrderStatus(order.id),disabled:order.status==='Picked Up',children:order.status==='Picked Up'?'Picked Up':'Mark as Picked Up'}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger btn-sm mx-1\",onClick:()=>deleteOrder(order.id),children:\"Delete\"})]})]},order.id))})]})]});}export default OrderManagement;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","jsx","_jsx","jsxs","_jsxs","OrderManagement","orders","setOrders","errorMessage","setErrorMessage","navigate","userEmail","localStorage","getItem","validateAdmin","alert","email","response","fetch","method","headers","body","JSON","stringify","data","json","valid","fetchOrders","error","console","ok","updateOrderStatus","orderId","map","order","id","status","deleteOrder","filter","handleReassignOrder","className","children","onClick","pickup_location","drop_off_location","package_details","delivery_time","user_id","disabled"],"sources":["C:/Users/Eslam/OneDrive/Desktop/last version/tools3_project/front-end/src/components/admin/OrderManagement.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nfunction OrderManagement() {\r\n  const [orders, setOrders] = useState([]);\r\n  const [errorMessage, setErrorMessage] = useState('');\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const userEmail = localStorage.getItem('userEmail');\r\n\r\n    // Validate if the user email belongs to an admin\r\n    if (userEmail) {\r\n      validateAdmin(userEmail);\r\n    } else {\r\n      alert('Please log in first');\r\n      navigate('/login-admin');\r\n    }\r\n  }, [navigate]);\r\n\r\n  // Validate if the email exists in the admins table\r\n  const validateAdmin = async (email) => {\r\n    try {\r\n      const response = await fetch('http://localhost:3000/validate-admin', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ email }),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      // If the email is not valid, redirect to login\r\n      if (!data.valid) {\r\n        alert('You are not authorized to access this page. Please log in as an admin.');\r\n        navigate('/login');\r\n      } else {\r\n        // Fetch orders only if the admin validation is successful\r\n        fetchOrders();\r\n      }\r\n    } catch (error) {\r\n      console.error('Validation error:', error);\r\n      alert('An error occurred during validation. Please log in again.');\r\n      navigate('/login');\r\n    }\r\n  };\r\n\r\n  // Fetch all orders from the backend\r\n  const fetchOrders = async () => {\r\n    try {\r\n      const response = await fetch('http://localhost:3000/orders');\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setOrders(data);\r\n      } else {\r\n        setErrorMessage('Failed to fetch orders');\r\n      }\r\n    } catch (error) {\r\n      setErrorMessage('Error fetching orders');\r\n    }\r\n  };\r\n\r\n  // Update order status to \"Picked Up\"\r\n  const updateOrderStatus = async (orderId) => {\r\n    try {\r\n      const response = await fetch(`http://localhost:3000/orders/${orderId}/pickup`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n\r\n      if (response.ok) {\r\n        setOrders(orders.map(order =>\r\n          order.id === orderId ? { ...order, status: 'Picked Up' } : order\r\n        ));\r\n      } else {\r\n        setErrorMessage('Failed to update order status');\r\n      }\r\n    } catch (error) {\r\n      setErrorMessage('Error updating order status');\r\n    }\r\n  };\r\n\r\n  // Delete an order\r\n  const deleteOrder = async (orderId) => {\r\n    try {\r\n      const response = await fetch(`http://localhost:3000/orders/${orderId}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (response.ok) {\r\n        setOrders(orders.filter(order => order.id !== orderId));\r\n      } else {\r\n        setErrorMessage('Failed to delete order');\r\n      }\r\n    } catch (error) {\r\n      setErrorMessage('Error deleting order');\r\n    }\r\n  };\r\n\r\n  // Navigate to reassignOrders page\r\n  const handleReassignOrder = () => {\r\n    navigate('/reassignOrders');\r\n  };\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <h2 className=\"text-center my-4\">Order Management</h2>\r\n      \r\n      {/* Reassign Order Button */}\r\n      <button\r\n        className=\"btn btn-warning mb-3\"\r\n        onClick={handleReassignOrder}\r\n      >\r\n        Reassign Order\r\n      </button>\r\n\r\n      {errorMessage && <div className=\"alert alert-danger\">{errorMessage}</div>}\r\n\r\n      <table className=\"table table-bordered\">\r\n        <thead>\r\n          <tr>\r\n            <th>ID</th>\r\n            <th>Pickup Location</th>\r\n            <th>Drop-Off Location</th>\r\n            <th>Package Details</th>\r\n            <th>Delivery Time</th>\r\n            <th>User ID</th>\r\n            <th>Status</th>\r\n            <th>Actions</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {orders.map(order => (\r\n            <tr key={order.id}>\r\n              <td>{order.id}</td>\r\n              <td>{order.pickup_location}</td>\r\n              <td>{order.drop_off_location}</td>\r\n              <td>{order.package_details}</td>\r\n              <td>{order.delivery_time}</td>\r\n              <td>{order.user_id}</td>\r\n              <td>{order.status || 'Pending'}</td>\r\n              <td>\r\n                <button\r\n                  className=\"btn btn-primary btn-sm mx-1\"\r\n                  onClick={() => updateOrderStatus(order.id)}\r\n                  disabled={order.status === 'Picked Up'}\r\n                >\r\n                  {order.status === 'Picked Up' ? 'Picked Up' : 'Mark as Picked Up'}\r\n                </button>\r\n                <button\r\n                  className=\"btn btn-danger btn-sm mx-1\"\r\n                  onClick={() => deleteOrder(order.id)}\r\n                >\r\n                  Delete\r\n                </button>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OrderManagement;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}